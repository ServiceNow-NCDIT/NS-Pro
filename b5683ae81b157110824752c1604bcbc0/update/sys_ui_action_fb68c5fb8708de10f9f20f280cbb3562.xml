<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_ui_action">
    <sys_ui_action action="INSERT_OR_UPDATE">
        <action_name/>
        <active>true</active>
        <client>true</client>
        <client_script_v2><![CDATA[function onClick(g_form) {

}]]></client_script_v2>
        <comments/>
        <condition>RP.isRelatedList() &amp;&amp; RP.getReferringURL().indexOf("cmdb_ci_site.do") == 0 &amp;&amp; current.install_status == 1</condition>
        <form_action>false</form_action>
        <form_button>false</form_button>
        <form_button_v2>false</form_button_v2>
        <form_context_menu>false</form_context_menu>
        <form_link>false</form_link>
        <form_menu_button_v2>false</form_menu_button_v2>
        <form_style/>
        <format_for_configurable_workspace>false</format_for_configurable_workspace>
        <hint/>
        <isolate_script>true</isolate_script>
        <list_action>true</list_action>
        <list_banner_button>false</list_banner_button>
        <list_button>false</list_button>
        <list_choice>false</list_choice>
        <list_context_menu>true</list_context_menu>
        <list_link>false</list_link>
        <list_save_with_form_button>false</list_save_with_form_button>
        <list_style>destructive</list_style>
        <messages/>
        <name>Decommission Circuit</name>
        <onclick>decomissionCircuit()</onclick>
        <order>1</order>
        <script><![CDATA[function decomissionCircuit() {
    var selectedSite = g_form.getValue('name');
    var selectedSiteID = g_form.getValue('site_identifier');
    var site_sysid = g_form.getUniqueValue();
    var selectedRecord = rowSysId;
    var siteCircuitInformation = {};
    siteCircuitInformation.selectedSite = selectedSite;
    siteCircuitInformation.selectedSiteID = selectedSiteID;
    siteCircuitInformation.site_sysid = site_sysid;
    siteCircuitInformation.selectedRecord = selectedRecord;


    var cmdbCISite = new GlideAjax('x_g_sonc_ns_pro.cmdb_ci_site_ajax');
    cmdbCISite.addParam('sysparm_name', 'getSiteCircuitInformation');
    cmdbCISite.addParam('sysparm_siteCircuitSysId', selectedRecord);
    cmdbCISite.getXMLAnswer(getResponse);

    function getResponse(response) {
        //alert(response);
        var responseObj = JSON.parse(response);
        //alert(responseObj);
        if (responseObj.resultCode == "success") {
            var circuitInfo = responseObj.result;
	
            siteCircuitInformation.circuitId = circuitInfo.circuitId;
            siteCircuitInformation.circuitSpeed = circuitInfo.circuitSpeed;
            siteCircuitInformation.circuitType = circuitInfo.circuitType;
            siteCircuitInformation.hostCircuit = circuitInfo.hostCircuit;
            siteCircuitInformation.telco = circuitInfo.telco;
            siteCircuitInformation.telcoSysId = circuitInfo.telcoSysId;
            g_scratchpad.siteCircuitInformation = siteCircuitInformation;

            var gm = new GlideModal("glide_confirm_standard", true, 800);
            gm.setTitle("Initiate Circuit Decommission Site: " + selectedSiteID + " - " + selectedSite);
            gm.setPreference("title", "Are you sure you want to initiate decommissioning the circuit for site: " + selectedSiteID + " - " + selectedSite + "\n Circuit ID: " + siteCircuitInformation.circuitId + " Circuit Speed: " + siteCircuitInformation.circuitSpeed + "\n Telco: " + siteCircuitInformation.telco);
            gm.setPreference("warning", "false");
            gm.setPreference("onPromptComplete", initiateDecommission);
            gm.setPreference("onPromptCancel", cancelDecommission);
            gm.render();


        } else {
            alert(responseObj.errorMessage);
            return false;
        }
    }

    function cancelDecommission() {
        return false;
    }

    function initiateDecommission() {
        siteCircuitInformation = g_scratchpad.siteCircuitInformation;
        var cmdbCISite = new GlideAjax('x_g_sonc_ns_pro.cmdb_ci_site_ajax');
        cmdbCISite.addParam('sysparm_name', 'initiateSiteCircuitDecomm');
        cmdbCISite.addParam('sysparm_siteSysId', siteCircuitInformation.site_sysid);
        cmdbCISite.addParam('sysparm_siteCircuitSysId', siteCircuitInformation.selectedRecord);
        cmdbCISite.addParam('sysparm_telcoSysId', siteCircuitInformation.telcoSysId);


        cmdbCISite.getXMLAnswer(getInitiateResponse);

        function getInitiateResponse(response) {
            if (response == "success") {
				var initDone = new GlideModal("glide_confirm_standard", false, 600);
				initDone.setTitle("Decomission Initiation Completed");
				initDone.setPreference("title", "Circuit: " + siteCircuitInformation.circuitId + " for site: " + siteCircuitInformation.selectedSiteID + " - " + siteCircuitInformation.selectedSite + " has been submitted for decommissioning to telco provider: " + siteCircuitInformation.telco);
				initDone.setPreference("onPromptComplete", function(){location.reload();return true;});
				initDone.setPreference("onPromptCancel", function(){location.reload();return true;});
				initDone.setPreference("warning", "false");
				initDone.setPreference("alignment","center");
				initDone.render();

                
            } else {
                return false;
            }
        }

        return true;
    }
}]]></script>
        <show_insert>true</show_insert>
        <show_multiple_update>false</show_multiple_update>
        <show_query>false</show_query>
        <show_update>true</show_update>
        <sys_class_name>sys_ui_action</sys_class_name>
        <sys_created_by>admglfry</sys_created_by>
        <sys_created_on>2024-08-22 21:33:38</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>fb68c5fb8708de10f9f20f280cbb3562</sys_id>
        <sys_mod_count>50</sys_mod_count>
        <sys_name>Decommission Circuit</sys_name>
        <sys_overrides/>
        <sys_package display_value="NS Pro" source="x_g_sonc_ns_pro">b5683ae81b157110824752c1604bcbc0</sys_package>
        <sys_policy/>
        <sys_scope display_value="NS Pro">b5683ae81b157110824752c1604bcbc0</sys_scope>
        <sys_update_name>sys_ui_action_fb68c5fb8708de10f9f20f280cbb3562</sys_update_name>
        <sys_updated_by>admglfry</sys_updated_by>
        <sys_updated_on>2024-08-23 05:54:57</sys_updated_on>
        <table>cmdb_ci_network_circuit</table>
        <ui11_compatible>true</ui11_compatible>
        <ui16_compatible>false</ui16_compatible>
    </sys_ui_action>
</record_update>
